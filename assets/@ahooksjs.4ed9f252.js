import{r as t,R as e}from"./react.eb42bb38.js";import{l as r}from"./lodash.debounce.4ed8aa89.js";import{l as n}from"./lodash.throttle.e596c563.js";function o(){return"undefined"==typeof document||void 0===document.visibilityState||"hidden"!==document.visibilityState}var i=new Map,a=function(t){var e=i.get(t);return{data:null==e?void 0:e.data,startTime:null==e?void 0:e.startTime}},u=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},l=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t};var c=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},s=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t};function f(e){var r=t.exports.useRef((function(){throw new Error("Cannot call an event handler while rendering.")}));r.current=e;var n=t.exports.useCallback((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r.current;if(n)return n.apply(void 0,s(t))}),[r]);if("function"==typeof e)return n}var h=function(e,r){var n=t.exports.useRef(!1);t.exports.useEffect((function(){return function(){n.current=!1}}),[]),t.exports.useEffect((function(){if(n.current)return e();n.current=!0}),r)},d=[];var p=!1;if("undefined"!=typeof window&&window.addEventListener&&!p){var v=function(){if(o()&&(void 0===navigator.onLine||navigator.onLine))for(var t=0;t<d.length;t++){(0,d[t])()}};window.addEventListener("visibilitychange",v,!1),window.addEventListener("focus",v,!1),p=!0}var y=[];var g=!1;if("undefined"!=typeof window&&window.addEventListener&&!g){window.addEventListener("visibilitychange",(function(){if(o())for(var t=0;t<y.length;t++){(0,y[t])()}}),!1),g=!0}var m=function(){return(m=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},b=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},w=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(b(arguments[e]));return t},x="AHOOKS_USE_REQUEST_DEFAULT_KEY",O=function(){function t(t,e,o,i){var a,u,c,s;this.count=0,this.pollingWhenVisibleFlag=!1,this.pollingTimer=void 0,this.loadingDelayTimer=void 0,this.unsubscribe=[],this.that=this,this.state={loading:!1,params:[],data:void 0,error:void 0,run:this.run.bind(this.that),mutate:this.mutate.bind(this.that),refresh:this.refresh.bind(this.that),cancel:this.cancel.bind(this.that),unmount:this.unmount.bind(this.that)},this.service=t,this.config=e,this.subscribe=o,i&&(this.state=m(m({},this.state),i)),this.debounceRun=this.config.debounceInterval?r(this._run,this.config.debounceInterval):void 0,this.throttleRun=this.config.throttleInterval?n(this._run,this.config.throttleInterval):void 0,this.limitRefresh=(a=this.refresh.bind(this),u=this.config.focusTimespan,c=!1,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];c||(c=!0,a.apply(void 0,l(t)),setTimeout((function(){c=!1}),u))}),this.config.pollingInterval&&this.unsubscribe.push((s=this.rePolling.bind(this),y.push(s),function(){var t=y.indexOf(s);y.splice(t,1)})),this.config.refreshOnWindowFocus&&this.unsubscribe.push(function(t){return d.push(t),function(){var e=d.indexOf(t);d.splice(e,1)}}(this.limitRefresh.bind(this)))}return t.prototype.setState=function(t){void 0===t&&(t={}),this.state=m(m({},this.state),t),this.subscribe(this.state)},t.prototype._run=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.pollingTimer&&clearTimeout(this.pollingTimer),this.loadingDelayTimer&&clearTimeout(this.loadingDelayTimer),this.count+=1;var n=this.count;return this.setState({loading:!this.config.loadingDelay,params:e}),this.config.loadingDelay&&(this.loadingDelayTimer=setTimeout((function(){t.setState({loading:!0})}),this.config.loadingDelay)),this.service.apply(this,w(e)).then((function(r){if(n!==t.count)return new Promise((function(){}));t.loadingDelayTimer&&clearTimeout(t.loadingDelayTimer);var o=t.config.formatResult?t.config.formatResult(r):r;return t.setState({data:o,error:void 0,loading:!1}),t.config.onSuccess&&t.config.onSuccess(o,e),o})).catch((function(r){if(n!==t.count)return new Promise((function(){}));if(t.loadingDelayTimer&&clearTimeout(t.loadingDelayTimer),t.setState({data:void 0,error:r,loading:!1}),t.config.onError&&t.config.onError(r,e),t.config.throwOnError)throw r;return console.error(r),Promise.reject("useRequest has caught the exception, if you need to handle the exception yourself, you can set options.throwOnError to true.")})).finally((function(){if(n===t.count&&t.config.pollingInterval){if(!o()&&!t.config.pollingWhenHidden)return void(t.pollingWhenVisibleFlag=!0);t.pollingTimer=setTimeout((function(){t._run.apply(t,w(e))}),t.config.pollingInterval)}}))},t.prototype.run=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.debounceRun?(this.debounceRun.apply(this,w(t)),Promise.resolve(null)):this.throttleRun?(this.throttleRun.apply(this,w(t)),Promise.resolve(null)):this._run.apply(this,w(t))},t.prototype.cancel=function(){this.debounceRun&&this.debounceRun.cancel(),this.throttleRun&&this.throttleRun.cancel(),this.loadingDelayTimer&&clearTimeout(this.loadingDelayTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.pollingWhenVisibleFlag=!1,this.count+=1,this.setState({loading:!1})},t.prototype.refresh=function(){return this.run.apply(this,w(this.state.params))},t.prototype.rePolling=function(){this.pollingWhenVisibleFlag&&(this.pollingWhenVisibleFlag=!1,this.refresh())},t.prototype.mutate=function(t){"function"==typeof t?this.setState({data:t(this.state.data)||{}}):this.setState({data:t})},t.prototype.unmount=function(){this.cancel(),this.unsubscribe.forEach((function(t){t()}))},t}();function S(e,r){var n,o=r||{},u=o.refreshDeps,l=void 0===u?[]:u,c=o.manual,s=void 0!==c&&c,d=o.onSuccess,p=void 0===d?function(){}:d,v=o.onError,y=void 0===v?function(){}:v,g=o.defaultLoading,S=void 0!==g&&g,T=o.loadingDelay,E=o.pollingInterval,R=void 0===E?0:E,j=o.pollingWhenHidden,P=void 0===j||j,D=o.defaultParams,C=void 0===D?[]:D,k=o.refreshOnWindowFocus,I=void 0!==k&&k,K=o.focusTimespan,M=void 0===K?5e3:K,F=o.fetchKey,L=o.cacheKey,W=o.cacheTime,z=void 0===W?3e5:W,_=o.staleTime,H=void 0===_?0:_,q=o.debounceInterval,V=o.throttleInterval,U=o.initialData,Y=o.ready,N=void 0===Y||Y,A=o.throwOnError,Q=void 0!==A&&A,B=t.exports.useRef(x),G=f(e),J=f(p),X=f(y),Z=f(F);"formatResult"in o&&(n=o.formatResult);var $={formatResult:f(n),onSuccess:J,onError:X,loadingDelay:T,pollingInterval:R,pollingWhenHidden:P,refreshOnWindowFocus:!s&&I,focusTimespan:M,debounceInterval:q,throttleInterval:V,throwOnError:Q},tt=f((function(t,e){nt((function(r){return r[t]=e,m({},r)}))})),et=b(t.exports.useState((function(){var t;if(L){var e=null===(t=a(L))||void 0===t?void 0:t.data;if(e){B.current=e.newstFetchKey;var r={};return Object.keys(e.fetches).forEach((function(t){var n=e.fetches[t],o=new O(G,$,tt.bind(null,t),{loading:n.loading,params:n.params,data:n.data,error:n.error});r[t]=o.state})),r}}return{}})),2),rt=et[0],nt=et[1],ot=t.exports.useRef(rt);ot.current=rt;var it=t.exports.useRef(),at=t.exports.useCallback((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(N){if(Z){var r=Z.apply(void 0,w(t));B.current=void 0===r?x:r}var n=B.current,o=ot.current[n];if(!o){var i=new O(G,$,tt.bind(null,n),{data:U});o=i.state,nt((function(t){return t[n]=o,m({},t)}))}return o.run.apply(o,w(t))}it.current=t}),[F,tt,N]),ut=t.exports.useRef(at);ut.current=at,h((function(){L&&function(t,e,r){var n=i.get(t);(null==n?void 0:n.timer)&&clearTimeout(n.timer);var o=void 0;e>-1&&(o=setTimeout((function(){i.delete(t)}),e)),i.set(t,{data:r,timer:o,startTime:(new Date).getTime()})}(L,z,{fetches:rt,newstFetchKey:B.current})}),[L,rt]);var lt=t.exports.useRef(!1);h((function(){N&&(!lt.current&&it.current&&ut.current.apply(ut,w(it.current)),lt.current=!0)}),[N]),t.exports.useEffect((function(){var t;if(!s)if(Object.keys(rt).length>0){var e=L&&(null===(t=a(L))||void 0===t?void 0:t.startTime)||0;-1===H||(new Date).getTime()-e<=H||Object.values(rt).forEach((function(t){t.refresh()}))}else ut.current.apply(ut,w(C))}),[]);var ct=t.exports.useCallback((function(){Object.values(ot.current).forEach((function(t){t.unmount()})),B.current=x,nt({}),ot.current={}}),[nt]);h((function(){s||Object.values(ot.current).forEach((function(t){t.refresh()}))}),w(l)),t.exports.useEffect((function(){return function(){Object.values(ot.current).forEach((function(t){t.unmount()}))}}),[]);var st=t.exports.useCallback((function(t){return function(){console.warn("You should't call "+t+" when service not executed once.")}}),[]);return m(m({loading:N&&!s||S,data:U,error:void 0,params:[],cancel:st("cancel"),refresh:st("refresh"),mutate:st("mutate")},rt[B.current]||{}),{run:at,fetches:rt,reset:ct})}var T=function(){return(T=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},E=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},R=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(E(arguments[e]));return t};function j(e,r){var n=r.refreshDeps,o=void 0===n?[]:n,i=r.ref,a=r.isNoMore,u=r.threshold,l=void 0===u?100:u;r.fetchKey;var c=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}(r,["refreshDeps","ref","isNoMore","threshold","fetchKey"]),s=E(t.exports.useState(!1),2),f=s[0],d=s[1];t.exports.useEffect((function(){r.fetchKey&&console.warn("useRequest loadMore mode don't need fetchKey!")}),[]);var p=S(e,T(T({},c),{fetchKey:function(t){var e;return(null===(e=null==t?void 0:t.list)||void 0===e?void 0:e.length)||0},onSuccess:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];d(!1),r.onSuccess&&r.onSuccess.apply(r,R(t))}})),v=p.data,y=p.run,g=p.params,m=p.reset,b=p.loading,w=p.fetches,x=t.exports.useCallback((function(){m();var t=E(g).slice(1);y.apply(void 0,R([void 0],t))}),[y,m,g]),O=t.exports.useRef(x);O.current=x,h((function(){r.manual||O.current()}),R(o));var j=t.exports.useMemo((function(){var t=[],e=v;return Object.values(w).forEach((function(r){var n,o;(null===(n=r.data)||void 0===n?void 0:n.list)&&(t=t.concat(null===(o=r.data)||void 0===o?void 0:o.list)),r.loading||(e=r.data)})),T(T({},e),{list:t})}),[w,v]),P=!!a&&(!b&&!f&&a(j)),D=t.exports.useCallback((function(){if(!P){d(!0);var t=E(g).slice(1);y.apply(void 0,R([j],t))}}),[P,y,j,g]),C=function(){!b&&!f&&i&&i.current&&i.current.scrollHeight-i.current.scrollTop<=i.current.clientHeight+l&&D()},k=t.exports.useRef(C);return k.current=C,t.exports.useEffect((function(){if(!i||!i.current)return function(){};var t=function(){return k.current()};return i.current.addEventListener("scroll",t),function(){i&&i.current&&i.current.removeEventListener("scroll",t)}}),[k]),T(T({},p),{data:j,reload:x,loading:b&&0===j.list.length,loadMore:D,loadingMore:f,noMore:P})}var P=function(){return(P=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},D=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r},C=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},k=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(C(arguments[e]));return t};var I=e.createContext({});I.displayName="UseRequestConfigContext";var K=function(){return(K=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},M=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r},F=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},L=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(F(arguments[e]));return t};function W(e,r){void 0===r&&(r={});var n=t.exports.useContext(I),o=K(K({},n),r),i=o.paginated,a=o.loadMore,u=o.requestMethod,l=t.exports.useRef(i),c=t.exports.useRef(a);if(l.current!==i)throw Error("You should not modify the paginated of options");if(c.current!==a)throw Error("You should not modify the loadMore of options");l.current=i,c.current=a;var s,f=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return fetch.apply(void 0,L(t)).then((function(t){if(t.ok)return t.json();throw new Error(t.statusText)}))},d=u||f;switch(typeof e){case"string":s=function(){return d(e)};break;case"object":var p=e.url,v=M(e,["url"]);s=function(){return u?u(e):f(p,v)};break;default:s=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new Promise((function(r,n){var o=e.apply(void 0,L(t)),i=o;if(!o.then)switch(typeof o){case"string":i=d(o);break;case"object":var a=o.url,l=M(o,["url"]);i=u?u(o):f(a,l)}i.then(r).catch(n)}))}}return a?j(s,o):i?function(e,r){r.paginated;var n=r.defaultPageSize,o=void 0===n?10:n,i=r.refreshDeps,a=void 0===i?[]:i,u=r.fetchKey,l=D(r,["paginated","defaultPageSize","refreshDeps","fetchKey"]);t.exports.useEffect((function(){u&&console.error("useRequest pagination's fetchKey will not work!")}),[]);var c=S(e,P({defaultParams:[{current:1,pageSize:o}]},l)),s=c.data,f=c.params,d=c.run,p=c.loading,v=D(c,["data","params","run","loading"]),y=f&&f[0]?f[0]:{},g=y.current,m=void 0===g?1:g,b=y.pageSize,w=void 0===b?o:b,x=y.sorter,O=void 0===x?{}:x,T=y.filters,E=void 0===T?{}:T,R=t.exports.useCallback((function(t){var e=C(f),r=e[0],n=e.slice(1);d.apply(void 0,k([P(P({},r),t)],n))}),[d,f]),j=(null==s?void 0:s.total)||0,I=t.exports.useMemo((function(){return Math.ceil(j/w)}),[w,j]),K=t.exports.useCallback((function(t,e){R({current:t,pageSize:e})}),[j,R]),M=t.exports.useCallback((function(t){K(t,w)}),[K,w]),F=t.exports.useCallback((function(t){K(m,t)}),[K,m]),L=t.exports.useRef(M);L.current=M,h((function(){r.manual||L.current(1)}),k(a));var W=t.exports.useCallback((function(t,e,r){R({current:t.current,pageSize:t.pageSize||o,filters:e,sorter:r})}),[E,O,R]);return P({loading:p,data:s,params:f,run:d,pagination:{current:m,pageSize:w,total:j,totalPage:I,onChange:K,changeCurrent:M,changePageSize:F},tableProps:{dataSource:(null==s?void 0:s.list)||[],loading:p,onChange:W,pagination:{current:m,pageSize:w,total:j}},sorter:O,filters:E},v)}(s,o):S(s,o)}I.Provider;export{W as u};
